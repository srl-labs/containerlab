# yaml-language-server: $schema=../../schemas/clab.schema.json
name: sr05

topology:
  kinds:
    nokia_srsim:
      license: /opt/nokia/sros/license-sros25.txt
      image: registry.srlinux.dev/pub/nokia_srsim:25.7.R1
  nodes:
    l1:
      kind: linux
      image: alpine:latest
      exec:
        - >
          ash -c '
          apk add iproute2 &&
          ip l set dev eth1 up &&
          ip addr add dev eth1 10.0.0.1/30'
    sros:
      kind: nokia_srsim
      type: sr-1-92s
      components: 
        - slot: A
        - slot: 1
      startup-config: |
        /configure port 1/1/c23 connector breakout c4-100g
        /configure port 1/1/c23 admin-state enable
        /configure port 1/1/c23/4 ethernet mode hybrid
        /configure port 1/1/c23/4 admin-state enable
        /configure router "Base" interface "to-linux" port 1/1/c23/4:0
        /configure router "Base" interface "to-linux" ipv4 primary address 10.0.0.2
        /configure router "Base" interface "to-linux" ipv4 primary prefix-length 24

    sr1-01:
      kind: nokia_srsim
      type: sr-1
      components: 
        - slot: A # override integrated MDA explicit slot
          mda:
            - slot: 1
              type: me12-100gb-qsfp28
      startup-config: |
        /configure card 1 admin-state enable
        /configure card 1 card-type iom-1

    sr1-02:
      kind: nokia_srsim
      type: sr-1
      components: 
         - mda: # override integrated MDA implicit slot
            - slot: 1
              type: me12-100gb-qsfp28
      startup-config: |
        /configure card 1 admin-state enable
        /configure card 1 card-type iom-1

    sr1-03:
      kind: nokia_srsim
      type: sr-1
      components: 
         - env:
              NOKIA_SROS_MDA_1: me12-100gb-qsfp28 # verify env MDA override on component
           mda:
               - slot: 1
                 type: me6-100gb-qsfp28
      startup-config: |
        /configure card 1 admin-state enable
        /configure card 1 card-type iom-1

    sr1-04:
      kind: nokia_srsim
      type: sr-1
      env: 
        NOKIA_SROS_MDA_1: me12-100gb-qsfp28 # verify env MDA override on node config
      components: 
         - mda:
            - slot: 1
              type: me6-100gb-qsfp28
      startup-config: |
        /configure card 1 admin-state enable
        /configure card 1 card-type iom-1
        
        
  links:
    - endpoints: ["l1:eth1", "sros:1/1/c23/4"]
