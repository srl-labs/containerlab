---
search:
  boost: 4
---
# FD.io VPP

## Getting VPP Containerlab image

The image is currently built using [Pim's github repo](https://github.com/pimvanpelt/vpp-containerlab).
When the integration is done, IPng Networks will host a publicly available Docker Repository where
the image can be downloaded.

## Managing VPP nodes

When VPP starts up on the commandline it expects a config file, typically in
`/etc/vpp/startup.conf`. We will generate this configuration file, and use the node context to set
the `.ShortName` in the CLI (see `startup.conf:unix { cli-prompt }`). I have defanged most of
the VPP configuration, notably: no need for hugepages, no need to load DPDK, and no need to do tight
loop polling (see `startup.conf:unix { poll-sleep-usec }`).

VPP wants vfio, tuntap and vhost.

VPP needs to run Privileged in Docker.

## Interfaces mapping

For each vethpair that containerlab offers to the docker container, we'll need to grab it and bind
it into VPP. This can be done using the API, or conveiently also using the debug CLI using the
following pattern:

```
$ vppctl

vpp-clab# create host-interface v2 name eth1
vpp-clab# set interface name host-eth1 eth1
vpp-clab# set interface mtu 9216 eth1
vpp-clab# set interface state eth1 up
vpp-clab# comment { And, optionally setting addresses }
vpp-clab# set interface ip address eth1 192.0.2.1/24
vpp-clab# set interface ip address eth1 2001:db8::1/64
```

Such statements can also be put in a file and executed after the dataplane comes up. This is done by
setting `startup.conf:unix { exec }`, and the docker container will run `/etc/vpp/manual-pre.vpp`,
followed by `/etc/vpp/clab.vpp` (which should be autogenerated by containerlab), and finally
`/etc/vpp/manual-post.vpp`. This allows for all manner of flexibility in the VPP dataplane
bootstrapping.

Some notes:
-   I am not sure about MTU. Can we configure this to be 9216 ?
-   Containerlab should generate `clab-startup.conf` and `clab.vpp` and bind them into `/etc/vpp/`
    in the container. The startup will wait for interfaces and then start VPP with the correct
    (generated) `clab-startup.conf` and then execute the (generated) `clab.vpp`
-   How do we determine how many vethpairs exist? We will need to generate `clab.vpp` to loop over
    all configured pairs

TODO(roman,pim): Fix the nodes/vpp/vpp.go as both of the templates are currently failing to generate
and I'm clearly overlooking something.

### My test .clab.yml file

```
name: learn-vpp
prefix: ""

topology:
  kinds:
    vpp:
      image: docker.io/pimvanpelt/vpp-containerlab:latest
    linux:
      image: ghcr.io/srl-labs/network-multitool

  nodes:
    vpp1:
      kind: vpp
    vpp2:
      kind: vpp
    client1:
      kind: linux
      exec:
        - ip link set address 00:c1:ab:00:00:01 dev eth1
        - ip addr add 192.168.0.1/24 dev eth1
    client2:
      kind: linux
      exec:
        - ip link set address 00:c1:ab:00:00:02 dev eth1
        - ip addr add 192.168.0.2/24 dev eth1

  links:
    - endpoints: ["vpp1:eth2", "vpp2:eth2"]
    - endpoints: ["client1:eth1", "vpp1:eth1"]
    - endpoints: ["client2:eth1", "vpp2:eth1"]
```
